Bootstrap: docker
From: nvidia/cuda:12.9.1-base-ubuntu22.04

%post
    # Install build deps
    apt-get -q update
    DEBIAN_FRONTEND=noninteractive apt-get install --no-install-recommends -y \
        git \
        python3-pip \
        build-essential
    
    # Install the provided versions of pip packages
    pip install -U  \
        biopython==1.86 \
        git+https://github.com/NVIDIA/dllogger#egg=dllogger \
        dm-haiku==0.0.15 \
        dm-tree==0.1.9 \
        flax==0.10.4 \
        "jax[cuda12]==0.4.38" \
        ml-collections==1.1.0 \
        ml_dtypes==0.5.3 \
        mock==5.2.0 \
        pyrosetta_installer \
        tensorflow==2.20.0

    # Install PyRosetta
    python3 -c 'import pyrosetta_installer; pyrosetta_installer.install_pyrosetta()'

    # Clone the dl_binder_design repository
    git clone https://github.com/PapenfussLab/dl_binder_design.git  /dl_binder_design

    # Clean up
    rm -rf /var/lib/apt/lists/*
    apt-get autoremove -y
    apt-get clean

%test
    python3 /dl_binder_design/af2_initial_guess/predict.py --help

%runscript
    if [ $# -eq 0 ]; then
        exec /bin/bash --norc
    else
        exec "$@"
    fi

%labels
    AUTHOR JoshuaHardy
    Version 1.0
    Description "Apptainer container for AlphaFold2 Initial-Guess"

%help
    Container for running AlphaFold2 Initial-Guess with CUDA 12.9
    Execute with GPU support using: apptainer run --nv af2.sif
